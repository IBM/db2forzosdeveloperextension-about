<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.23.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Creating stored procedures - IBM Db2 for z/OS Developer Extension</title>
<meta name="description" content="This article covers the basics of using Db2 Developer Extension to create a simple stored procedure and then explains some of the more complex things you might need to do when you create a stored procedure, such as working with DBCS data and user-defined types. ">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="IBM Db2 for z/OS Developer Extension">
<meta property="og:title" content="Creating stored procedures">
<meta property="og:url" content="http://localhost:4000/2021/03/16/Creating-stored-procedures.html">


  <meta property="og:description" content="This article covers the basics of using Db2 Developer Extension to create a simple stored procedure and then explains some of the more complex things you might need to do when you create a stored procedure, such as working with DBCS data and user-defined types. ">







  <meta property="article:published_time" content="2021-03-16T00:00:00-07:00">






<link rel="canonical" href="http://localhost:4000/2021/03/16/Creating-stored-procedures.html">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="IBM Db2 for z/OS Developer Extension Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/logo.png" alt="IBM Db2 for z/OS Developer Extension"></a>
        
        <a class="site-title" href="/">
          IBM Db2 for z/OS Developer Extension
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/blogs/">Blogs</a>
            </li><li class="masthead__menu-item">
              <a href="https://marketplace.visualstudio.com/items?itemName=ibm.db2forzosdeveloperextension">VS Code Marketplace</a>
            </li><li class="masthead__menu-item">
              <a href="https://github.com/IBM/db2forzosdeveloperextension-about/issues">GitHub</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name"></h3>
    
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">The basics</span>
        

        
        <ul>
          
            <li><a href="/2021/03/12/Getting-started.html">Getting started</a></li>
          
            <li><a href="/2021/06/15/Creating-a-database-connection.html">Creating a database connection</a></li>
          
            <li><a href="/2021/03/16/Committing-and-rolling-back-changes.html">Committing and rolling back changes</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Working with SQL</span>
        

        
        <ul>
          
            <li><a href="/2021/06/15/Preparing-to-run-an-SQL-statement.html">Preparing to run an SQL statement</a></li>
          
            <li><a href="/2021/06/16/Formatting-SQL.html">Formatting SQL</a></li>
          
            <li><a href="/2021/06/15/Running-multiple-SQL-statements.html">Running multiple SQL statements</a></li>
          
            <li><a href="/2021/03/12/Running-SQL-from-different-types-of-files.html">Running SQL from different types of files</a></li>
          
            <li><a href="/2021/06/15/Running-SQL-with-multiple-selection-scopes.html">Running SQL with multiple selection scopes</a></li>
          
            <li><a href="/2021/06/15/Running-SQL-from-within-a-stored-procedure.html">Running SQL from within a stored procedure</a></li>
          
            <li><a href="/2021/06/15/Saving-SQL-results-to-a-file.html">Saving SQL results to a file</a></li>
          
            <li><a href="/2021/06/16/Limiting-the-number-of-rows-returned.html">Limiting the number of rows returned</a></li>
          
            <li><a href="/2021/06/15/Comparing-SQL-results.html">Comparing SQL results</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Working with stored procedures</span>
        

        
        <ul>
          
            <li><a href="/2021/03/16/Creating-stored-procedures.html" class="active">Creating stored procedures</a></li>
          
            <li><a href="/2021/03/12/Deploying-running-and-debugging-stored-procedures-basics.html">Deploying, running, and debugging stored procedures</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Tips and tricks</span>
        

        
        <ul>
          
            <li><a href="/2021/06/15/Running-commands-from-the-command-palette.html">Running commands from the Command Palette</a></li>
          
            <li><a href="/2021/06/15/Creating-your-own-code-snippets.html">Creating your own code snippets</a></li>
          
            <li><a href="/2021/06/16/Setting-multiple-port-numbers.html">Setting multiple port numbers</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Troubleshooting</span>
        

        
        <ul>
          
            <li><a href="/2021/06/15/Opening-an-issue-and-providing-logs.html">Opening an issue and providing logs</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Creating stored procedures">
    <meta itemprop="description" content="This article covers the basics of using Db2 Developer Extension to create a simple stored procedure and then explains some of the more complex things you might need to do when you create a stored procedure, such as working with DBCS data and user-defined types. ">
    <meta itemprop="datePublished" content="2021-03-16T00:00:00-07:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Creating stored procedures
</h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#creating-a-basic-stored-procedure-with-code-snippets">Creating a basic stored procedure with code snippets</a></li><li><a href="#working-with-double-byte-character-set-dbcs-data">Working with double-byte character set (DBCS) data</a></li><li><a href="#working-with-user-defined-types-distinct">Working with user-defined types: Distinct</a></li><li><a href="#working-with-user-defined-types-arrays">Working with user-defined types: Arrays</a></li></ul>

            </nav>
          </aside>
        
        <p>This article covers the basics of using Db2 Developer Extension to create a simple stored procedure and then explains some of the more complex things you might need to do when you create a stored procedure, such as working with DBCS data and user-defined types. </p>

<p><a href="https://www.ibm.com/support/knowledgecenter/en/SSEPEK_12.0.0/apsg/src/tpc/db2z_storedprocedure.html">Stored procedures</a> are a powerful tool for increasing the performance and efficiency of distributed applications. Currently, Db2 Developer Extension supports Db2 for z/OS native stored procedures, which are stored procedures that are written entirely in SQL and are created by using the <a href="https://www.ibm.com/support/knowledgecenter/SSEPEK_12.0.0/sqlref/src/tpc/db2z_sql_createproceduresqlnative.html">CREATE PROCEDURE or CREATE  OR REPLACE PROCEDURE</a> statement, which is available with Db2 12 function level 507 and later.</p>

<h2 id="creating-a-basic-stored-procedure-with-code-snippets">Creating a basic stored procedure with code snippets</h2>

<ol>
  <li>
    <p>Open a new <strong>.spsql</strong> file, and start typing <code class="language-plaintext highlighter-rouge">CREATE PROCEDURE</code>. You’ll only need to type a few letters before you see CREATE PROCEDURE in the list of available code snippets.</p>
  </li>
  <li>
    <p>Select that snippet to populate your file with the basic CREATE PROCEDURE structure (in the following example, the procedure name has already been changed to MYPROCEDURE):</p>
  </li>
</ol>

<p><img src="/assets/images/create-sp-snippet.png" alt="CREATE PROCEDURE code snippet" /></p>

<p>The snippet includes some of the more commonly used parameters and an example SELECT statement. The SELECT statement is the part of the stored procedure that gets executed when the stored procedure is called. To see all of the options that you can define in a stored procedure, open the <a href="https://www.ibm.com/support/knowledgecenter/SSEPEK_12.0.0/sqlref/src/tpc/db2z_sql_createproceduresqlnative.html">link</a> that is included at the top of the snippet. </p>

<p>Now this stored procedure is ready to be deployed. To learn how, see <a href="/2021/03/12/Deploying-running-and-debugging-stored-procedures-basics.html">Deploying, running, and debugging stored procedures</a>.</p>

<p>Now let’s look at some more complex examples.</p>

<h2 id="working-with-double-byte-character-set-dbcs-data">Working with double-byte character set (DBCS) data</h2>

<p>Languages such as Chinese and Japanese contain double-byte characters, which are characters that are too large to represent with a single byte.  If you write SQL applications that support double-byte character languages, you need to know a bit about how Db2 for z/OS supports DBCS data and how character translation is handled.  This section describes how to code DBCS data in a Db2 for z/OS native stored procedure. </p>

<p>Db2 for z/OS provides DBCS support for the following data types:</p>

<ul>
  <li>
    <p><strong>GRAPHIC:</strong> A fixed-length data type that’s used to store a graphic string.</p>
  </li>
  <li>
    <p><strong>VARGRAPHIC:</strong> A varying-length data type used to store a variable-length graphic string.</p>
  </li>
  <li>
    <p><strong>CHAR or CLOB defined with “FOR MIXED DATA”:</strong> Data types that are used to store character data or mixed data (that is, a combination of single-byte character set (SBCS) characters and multi-byte character set (MBCS) characters).”</p>
  </li>
  <li>
    <p><strong>DBCLOB:</strong> A double-byte character large object.</p>
  </li>
</ul>

<p><strong>Tip:</strong> Db2 translates all Db2 character data between the internal Db2 table Code Character Set Identifier (CCSID) and the external application CCSID.</p>

<p>The following example shows a user-defined type stored procedure that includes a double-byte DBCLOB variable. When you create a stored procedure that includes DBCLOB parameters, you need to specify <code class="language-plaintext highlighter-rouge">PARAMETER CCSID UNICODE</code>, and if the stored procedure includes DBCLOBs in the body, you need to specify <code class="language-plaintext highlighter-rouge">APPLICATION ENCODING SCHEMA UNICODE</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE PROCEDURE ADMF001.TEST_DBCLOB (
  IN VAR1 DBCLOB,
  INOUT VAR2 DBCLOB,
  OUT VAR3 DBCLOB
  )
  APPLICATION ENCODING SCHEME UNICODE
  PARAMETER CCSID UNICODE
  VERSION V1
  ISOLATION LEVEL CS
  LANGUAGE SQL
  BEGIN
    SET VAR2 = '你好';
    SET VAR3 = VAR1;
  END
</code></pre></div></div>
<p>Setting this input returns the following output:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VAR1  IN: HELLOWORLD
VAR2 OUT: 你好
VAR3 OUT: HELLOWORLD
</code></pre></div></div>

<h2 id="working-with-user-defined-types-distinct">Working with user-defined types: Distinct</h2>

<p>You can create and use a custom data type that’s called a <a href="https://www.ibm.com/support/knowledgecenter/en/SSEPEK_12.0.0/sqlref/src/tpc/db2z_distincttypessql.html">user-defined distinct type</a> in Db2 for z/OS. For example, let’s say that you keep email documents that are sent to your company in a Db2 table. The Db2 data type of an email document is a CLOB, but you define it as a distinct type so that you can control the types of operations that are performed on the email data. The distinct type is defined like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE DISTINCT TYPE E_MAIL AS CLOB(5M); 
</code></pre></div></div>
<p>Now you can define and write a native stored procedure or user-defined function to search for and return the following information about an email document: </p>

<ul>
  <li>Subject </li>
  <li>Sender </li>
  <li>Date sent </li>
  <li>Message content </li>
  <li>Indicator of whether the document contains a user-specified string.</li>
</ul>

<p>The following example shows how to create a user-defined distinct type for a currency (US_DOLLAR), how to include it in a stored procedure, and how to do some calculations. </p>

<p>Note that the US_DOLLAR distinct type does not automatically inherit the functions and operators of its source type, DECIMAL. You can use <strong>casting</strong> functions to assign values other than host variables. Also, the DISTINCT keyword is optional.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE DISTINCT TYPE US_DOLLAR AS DECIMAL(9,2);
CREATE TYPE EURO AS DECIMAL(9,2);
 
CREATE PROCEDURE ADMF001.SALESSUM (
   IN DOLLAR_AMOUNT US_DOLLAR,
   IN EURO_AMOUNT EURO,
   OUT TOTAL_DOLLAR US_DOLLAR,
   OUT TOTAL_EURO EURO
  )
  LANGUAGE SQL
  VERSION V1
  ISOLATION LEVEL CS 
  BEGIN
    SET TOTAL_DOLLAR = DECIMAL(DOLLAR_AMOUNT)*200;
    SET TOTAL_EURO = DECIMAL(EURO_AMOUNT)+300.07;
  END
</code></pre></div></div>
<p>Setting this input returns the following output:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DOLLAR_AMOUNT  IN: 34.50
EURO_AMOUNT    IN: 500
TOTAL_DOLLAR  OUT: 6900.00
TOTAL_DOLLAR  OUT: 30507.00
</code></pre></div></div>

<h2 id="working-with-user-defined-types-arrays">Working with user-defined types: Arrays</h2>

<p>An array value is a structure that contains an ordered collection of elements. Arrays make it easier to exchange long lists of values with the Db2 server. You can create a user-defined data type for an array in Db2 for z/OS.</p>

<p>The following example shows how to create an ordinary array user-defined type (PHONENUMBERS) that can contain a maximum of 50 elements. The elements are of the DECIMAL(10,0) data type. The array index starts with 1. </p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TYPE PHONENUMBERS AS DECIMAL(10,0) ARRAY[50];

CREATE PROCEDURE ADMF001.TESTPROC(
   IN PHONENUMBER PHONENUMBERS,
   OUT outPHONENUMBER PHONENUMBERS
  )
  LANGUAGE SQL
  VERSION V1
  ISOLATION LEVEL CS
  BEGIN
    SET outPHONENUMBER[1]= PHONENUMBER[1];
  END
</code></pre></div></div>
<p>Setting this input returns the following output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PHONENUMBER      IN: [6262158888;4056789999]
outPHONENUMBER  OUT: [6262158888]
</code></pre></div></div>
<p>The following example shows how to create an ordinary arrays user-defined type for time and timestamp with time zone. The default TIMESTAMP WITH TIME ZONE length is 6.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TYPE TIMEARRAY AS TIME ARRAY[];
CREATE TYPE TIMESTAMPARRAY AS TIMESTAMP WITH TIME ZONE ARRAY[];

CREATE PROCEDURE ADMF001.TESTPROC (
  IN inTIME TIMEARRAY,
  IN inTIMESTAMPWITHZONE TIMESTAMPARRAY
  OUT outTIME TIME
  OUT outTIMESTAPWITHZONE TIMESTAMPARRAY
    )
  LANGUAGE SQL
  VERSION V1
  ISOLATION LEVEL CS
  BEGIN
    SET outTIME = INTIME[1];
    SET outTIMESTAMPWITHZONE[1] = inTIMESTAMPWITHZONE[1];
  END
</code></pre></div></div>
<p>Setting this input returns the following output:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>inTIME               IN: [08:09:01;10:15:00;11:08:30]
inTIMESTAMPWITHZONE  IN: [2020-10-15 15:01:01.111213141516+4:00]
outTIME             OUT: 08:09:01
outTIMESTAPWITHZONE OUT: [2020-10-15 15:01:01.111213]
</code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2021-03-16T00:00:00-07:00">March 16, 2021</time></p>


      </footer>

      

      <!--

  <nav class="pagination">
    
      <a href="/2021/03/16/Committing-and-rolling-back-changes.html" class="pagination--pager" title="Committing and rolling back changes
">Previous</a>
    
    
      <a href="/2021/06/14/Running-SQL.html" class="pagination--pager" title="Running SQL
">Next</a>
    
  </nav>

-->
    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 IBM Db2 for z/OS Developer Extension. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
